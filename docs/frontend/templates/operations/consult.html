<div class="row justify-content-center mt-4">
    <div class="col-9">
        <div class="row">
            <div class="col">
                <form id="consultForm" method="POST" onsubmit="sendConsult(this); return false;">
                    <div class="form-group row">
                        <label for="name" class="col-5 col-form-label">Nome do Job:</label>
                        <input type="text" class="form-control col-7 text-body" name="name" id="name">
                    </div>
                    <div class="form-group row">
                        <button type="submit" class="btn btn-primary btn-block">Procurar Job</button>
                    </div>
                </form>
            </div>
        </div>
        <div class="row">
            <div class="col p-0">
                <div class="alert" id="statusConsult" role="alert" hidden>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col">
                <div id="resultConsult" hidden>
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Resultados da Consulta</h5>
                            <div class="form-inline">
                                <label for="nameResult">Nome do Job:</label>
                                <span id="nameResult" class="ml-2"></span>
                            </div>
                            <div class="form-inline">
                                <label for="activeResult">Estado: </label>
                                <span id="activeResult" class="ml-2"></span>
                            </div>
                            <div class="form-inline align-items-center">
                                <label for="parentJobnameResult">Job dependente: </label>
                                <span id="parentJobnameResult" class="ml-2"></span>
                                <label for="parentJobactiveResult" class="ml-3">Estado: </label>
                                <span id="parentJobactiveResult" class="ml-2"></span>
                            </div>
                            <h5 class="text-center mt-2 mb-3">Lista de Tarefas</h5>
                            <table class="table" id="tasksTable" hidden>
                                <thead>
                                    <tr>
                                        <th scope="col">Nº</th>
                                        <th scope="col">Nome</th>
                                        <th scope="col">Peso</th>
                                        <th scope="col">Completada</th>
                                        <th scope="col">Criada em</th>
                                    </tr>
                                </thead>
                                <tbody id="tasksBody">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">

    function sendConsult(formObject) {
            resetAlert("statusConsult")
            getData(formObject, "consultHome").then((blob) => {
                var reader = new FileReader();
                reader.addEventListener("load", function() {
                    console.log(reader.result)
                    insertObjectsInScreen(JSON.parse(reader.result))
                })
                reader.readAsText(blob)
                return reader
            })
            return false
        }
    
    function insertObjectsInScreen(jsonObject) {
        if (jsonObject["status"] == "unsuccess") {
            return showAlert("alert alert-danger", "statusConsult", "Infelizmente não foi possível encontrar esse Job")
        }
        var propertysToFind = {
            "jobPropertys" : ["", "name", "active"],
            "parentJobPropertys" : ["parentJob", "name", "active"]
        }
        var keysProper = Object.keys(propertysToFind)
        console.log(jsonObject)
        for(var index=0;index < keysProper.length;index++) {
            var arrayProper = propertysToFind[keysProper[index]] // index = 0, arrayProper = ["", "name", "active"]
            var nameToFind = arrayProper[0];
            for(var indexProper=1;indexProper < arrayProper.length;indexProper++) { // Suportando apenas dois níveis no Json
                if(nameToFind == "") {
                    var valueToPut = jsonObject[arrayProper[indexProper]]
                } else {
                    var valueToPut = jsonObject[nameToFind][arrayProper[indexProper]]
                }
                if(valueToPut == true) {
                    valueToPut = "Ativada"
                } else if (valueToPut == false) {
                    valueToPut = "Desativada"
                }
                document.getElementById(nameToFind + arrayProper[indexProper] + "Result").innerText = valueToPut
            }
        }
        
        document.getElementById("resultConsult").hidden = false
        if (Object.keys(jsonObject).includes("tasks") == false) {
            return false;
        }
        document.getElementById("tasksBody").innerHTML = ""
        for(var index=0;index < jsonObject["tasks"].length;index++) {
            var taskData = jsonObject["tasks"][index]
            if(taskData["completed"] == true) {
                taskData["completed"] = "Sim"
            } else {
                taskData["completed"] = "Não"
            }
            document.getElementById("tasksBody").innerHTML += `
                <tr>
                    <th scope="row">` + (index + 1) + `</th>
                    <td>`+ taskData["name"] +`</td>
                    <td>`+ taskData["weight"] +`</td>
                    <td>`+ taskData["completed"] +`</td>
                    <td>`+ taskData["createdAt"] +`</td>
                </tr>
            `
        }
        document.getElementById("tasksTable").hidden = false
        return true
    }

</script>