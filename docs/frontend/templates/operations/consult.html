<div class="row justify-content-center mt-4">
    <div class="col-md-9">
        <div class="row">
            <div class="col">
                <form id="consultForm" method="POST" onsubmit="sendConsult(this); return false;">
                    <div class="form-group row">
                        <label for="name" class="col-sm-5 col-form-label">Nome do Job:</label>
                        <input type="text" class="form-control col-sm-7 text-body" name="name" id="name">
                    </div>
                    <div class="form-group row">
                        <button type="submit" class="btn btn-primary btn-block">Procurar Job</button>
                    </div>
                </form>
            </div>
        </div>
        <div class="row">
            <div class="col">
                <div id="resultConsult" hidden>
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Resultados da Consulta</h5>
                            <div class="form-inline">
                                <label for="nameResult">Nome do Job:</label>
                                <span id="nameResult" class="ml-2"></span>
                            </div>
                            <div class="form-inline">
                                <label for="activeResult">Estado: </label>
                                <span id="activeResult" class="ml-2"></span>
                            </div>
                            <div class="form-inline align-items-center">
                                <label for="parentJobResult">Job dependente: </label>
                                <span id="parentJobResult" class="ml-2"></span>
                            </div>
                            <h5 class="text-center mt-2 mb-3">Lista de Tarefas</h5>
                            <table class="table" id="tasksTable" hidden>
                                <thead>
                                    <tr>
                                        <th scope="col">NÂº</th>
                                        <th scope="col">Nome</th>
                                        <th scope="col">Peso</th>
                                        <th scope="col">Completada</th>
                                        <th scope="col">Criada em</th>
                                    </tr>
                                </thead>
                                <tbody id="tasksBody">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">

    function sendConsult(formObject) {
            getData(formObject, "consultHome").then((blob) => {
                var reader = new FileReader();
                reader.addEventListener("load", function() {
                    insertObjects(JSON.parse(reader.result))
                })
                reader.readAsText(blob)
                return reader
            })
            return false
        }
    
    function insertObjects(jsonObject) {
        var propertysToFind = ["name", "active", "parentJob"]
        reset(propertysToFind);
        for(var index=0;index < propertysToFind.length;index++) {
            var nameToFind = propertysToFind[index];
            document.getElementById(nameToFind + "Result").innerText = jsonObject[nameToFind]
        }
        document.getElementById("resultConsult").hidden = false
        if (jsonObject["tasks"] == []) {
            return false;
        }
        document.getElementById("tasksBody").innerHTML = ""
        for(var index=0;index < jsonObject["tasks"].length;index++) {
            var taskData = jsonObject["tasks"][index]
            document.getElementById("tasksBody").innerHTML += `
                <tr>
                    <th scope="row">` + (index + 1) + `</th>
                    <td>`+ taskData["name"] +`</td>
                    <td>`+ taskData["weight"] +`</td>
                    <td>`+ taskData["completed"] +`</td>
                    <td>`+ taskData["createdAt"] +`</td>
                </tr>
            `
        }
        document.getElementById("tasksTable").hidden = false
        return false
    }

    function reset(propertys) {
        for(var index=0; index < propertys.length; index++) {
            document.getElementById(propertys[index] + "Result");
        }
        return false;
    }
</script>