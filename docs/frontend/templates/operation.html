<!DOCTYPE html>
<head lang="pt-br">
    <title>Jobs Registrer</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="AllanRPereira">
    <meta name="description" content="Desenvolvimento de api simples para estudos">
    <meta name="keywords" content="estudo, api, banco de dados">
    <link href="{{url_for("static", filename="bootstrap.min.css")}}" rel="stylesheet">
    <script type="text/javascript">
        const yourToken = "{{ tokenAccess }}";
    </script>
</head>
<body>
    <div class="container-md">
        <div class="row justify-content-center mt-4">
            <div class="col-md-8">
                <h3>
                    Job Registrer - Sistema de registro de trabalhos e tarefas
                </h3>
            </div>
        </div>
        <div class="row justify-content-center mt-3">
            <div class="col-md-8">
                <ul class="nav nav-tabs justify-content-center" id="tabOperations" role="tablist">
                    {% set checkTabs = namespace(first=true) %}
                    {% set aliasName = {
                        "insert" : "Inserir",
                        "delete" : "Deletar",
                        "consult" : "Consultar",
                        "edit" : "Editar"
                    } %}
                    {% for functionAllow in permissions %}
                        {% if checkTabs.first %}
                            <li class="nav-item">
                                <a class="nav-link active" id="{{functionAllow}}-tab" data-toggle="tab" href="#{{functionAllow}}" role="tab" aria-controls="{{functionAllow}}"
                                    aria-selected="true">{{aliasName[functionAllow]}} Jobs</a>
                            </li>
                            {% set checkTabs.first = false%}
                        {% elif functionAllow == "delete" %}
                            <li class="nav-item">
                                <a class="nav-link text-danger" id="{{functionAllow}}-tab" data-toggle="tab" href="#{{functionAllow}}" role="tab" aria-controls="{{functionAllow}}"
                                    aria-selected="true">{{aliasName[functionAllow]}} Jobs</a>
                            </li>
                        {% else %}
                            <li class="nav-item">
                                <a class="nav-link" id="{{functionAllow}}-tab" data-toggle="tab" href="#{{functionAllow}}" role="tab" aria-controls="{{functionAllow}}"
                                    aria-selected="true">{{aliasName[functionAllow]}} Jobs</a>
                            </li>
                        {% endif %}
                    {% endfor %}
                </ul>
                <div class="tab-content" id="tabContentOperations">
                    {% set check = namespace(first=true) %}
                    {% for functionAllow in permissions %}
                        {% if check.first %}
                            <div class="tab-pane fade active show" id="{{functionAllow}}" role="tabpanel" aria-labelledby="{{functionAllow}}-tab">{% include 'operations/' ~ functionAllow ~ '.html' %}</div>
                            {% set check.first = false%}
                        {% else %}
                            <div class="tab-pane fade" id="{{functionAllow}}" role="tabpanel" aria-labelledby="{{functionAllow}}-tab">{% include 'operations/' ~ functionAllow ~ '.html' %}</div>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">

        function getData(formObject, operation) {
            const dataForm = new FormData(formObject);
            var object = {};
            dataForm.forEach((value, key) => {object[key] = value});
            object["token"] = yourToken;
            var jsonDataForm = JSON.stringify(object);
            console.log(jsonDataForm)
            var initContentFetch = {
                headers : {
                    "Content-Type" : "application/json"
                },
                method : "POST",
                mode : "cors",
                body : jsonDataForm
            }
            return fetch("/" + operation, initContentFetch).then((result) => {
                return result.blob();
            })
        }
        
        function showAlert(typeAlert, idAlert, messageAlert) {
            var alert = document.getElementById(idAlert)
            alert.hidden = false;
            alert.innerText = messageAlert;
            alert.className = typeAlert;
            return true
        }

        function resetAlert(idAlert) {
            document.getElementById(idAlert).hidden = true
        }

    </script>

    <script src="{{url_for("static", filename="jquery-3.4.1.slim.min.js")}}" ></script>
    <script src="{{url_for("static", filename="popper.min.js")}}"></script>
    <script src="{{url_for("static", filename="bootstrap.min.js")}}"></script>
</body>